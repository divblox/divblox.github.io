(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{142:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return r})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return b})),a.d(t,"default",(function(){return d}));var i=a(2),n=a(6),o=(a(0),a(150)),s=a(155),c=(a(152),a(153),a(156)),r={id:"the-basics-divblox-apis",title:"Divblox APIs"},l={id:"the-basics-divblox-apis",isDocsHomePage:!1,title:"Divblox APIs",description:"checkUrlScroll();",source:"@site/docs/the-basics-divblox-apis.mdx",permalink:"/docs/the-basics-divblox-apis",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/the-basics-divblox-apis.mdx",sidebar:"someSidebar",previous:{title:"Divblox Components",permalink:"/docs/the-basics-divblox-components"},next:{title:"Native Support",permalink:"/docs/the-basics-native-support"}};Object(c.a)();var b=[{value:"Exposing a custom API",id:"exposing-a-custom-api",children:[]},{value:"Securing API operations with an API key",id:"securing-api-operations-with-an-api-key",children:[]},{value:"Creating default CRUD API&#39;s",id:"creating-default-crud-apis",children:[]}],p={rightToc:b};function d(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"exposing-a-custom-api"},"Exposing a custom API"),Object(o.b)("p",null,"To expose any of your app's functionality as an api to the outside world, you simply need to create an endpoint in the following manner:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'Create a new php script that will contain your API operations and save it to the folder "/project/api/".')),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'Include "divblox.php" to use Divblox API classes.'))),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-php"}),'require("../../divblox/divblox.php");\n')),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},'Declare a new operation by calling the "addApiOperation()" function from the "PublicApi" class. The "Expected outputs", and "operation description" will be used when Divblox auto-generates the documentation for the newly created API, so do not overlook the importance of these description fields even though they don\'t directly effect functionality. The "User readable name" (API operation name) is later used to link operations to other API functionality.')),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-php"}),'PublicApi::addApiOperation(\n    ["Function Name"],\n    ["Input Parameters"],\n    ["Expected Outputs"] ,\n    ["User readable name"] ,\n    ["API operation description"]);\n')),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},'Initialize the API after your declarations using "initApi()" function from the "PublicApi" class.')),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-php"}),'PublicApi::initApi(\n    ["API description"],\n    ["API Title"]);\n\n')),Object(o.b)("ol",{start:5},Object(o.b)("li",{parentName:"ol"},'Functionality is added to the API by adding functions with titles that correspond with the API Operation\'s "Function Name" parameter from step 3.')),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},'Input parameters are retrieved using "getInputParameter()" along with the name of a parameter chosen in step 3.'),Object(o.b)("li",{parentName:"ul"},'The API operation output is created using "addApiOutput()" for which there is no restriction to the amount of outputs you can have but should be inline with the operation deceleration\'s expected output.'),Object(o.b)("li",{parentName:"ul"},'The API operation must be concluded by setting a return result to true or false, using "setApiResult(','["Boolean"]',')", to say if the request was successful and by printing the response with "printApiResult()".')),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-php"}),'\nfunction ["Function Name"]() {\n\n    $Variable = PublicApi::getInputParameter(["Input Parameter"]);\n    // *** Add User Code Here ***\n\n    PublicApi::addApiOutput("The Value of variable is","$Variable");\n    PublicApi::setApiResult(["Boolean"]);\n    PublicApi::printApiResult();\n}\n\n')),Object(o.b)("ol",{start:6},Object(o.b)("li",{parentName:"ol"},"Using the steps provided a dummy operation has been created to demonstrate the creation and testing. The following API has an operation that concatenates a first and last name. A second operation, that shows the systems current time, is added to show how multiple operations and functions can occupy the same file. An example of a new API would look as follows:")),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-php"}),'require("../../divblox/divblox.php");\n// Start by declaring your operations and then calling the initApi function\n\nPublicApi::addApiOperation(\n    "dummyOperation",\n    ["first_name",\n        "last_name"],\n    ["Message" => "You called the example operation",\n        "FullName" => "[The resulting full name]"],\n    "Example Operation",\n    "This is simply an example api operation that takes a first name and a last name and concatenates them");\n\nPublicApi::addApiOperation(\n    "dummyOperation2",\n    [],\n    ["Message" => "Current system time is [system_time]"],\n    "Example Operation 2",\n    "A simple operation that returns the current system time");\n\n\nPublicApi::initApi("Example API endpoint to illustrate the basics of divblox APIs","Example Endpoint");\n\n// Operations\nfunction dummyOperation() {\n    $Name = PublicApi::getInputParameter("first_name");\n    $Surname = PublicApi::getInputParameter("last_name");\n    PublicApi::addApiOutput("Message","You called the example operation.");\n    PublicApi::addApiOutput("FullName","$Name $Surname");\n    PublicApi::setApiResult(true); // You need to set this to true to indicate that the API executed successfully\n    PublicApi::printApiResult();\n}\nfunction dummyOperation2() {\n    PublicApi::addApiOutput("Message",\n                            "Current system time is ".dxDateTime::Now()->format(DATE_TIME_FORMAT_PHP_STR.\' H:i:s\'));\n    PublicApi::setApiResult(true); // You need to set this to true to indicate that the API executed successfully\n    PublicApi::printApiResult();\n}\n')),Object(o.b)("ol",{start:7},Object(o.b)("li",{parentName:"ol"},"Divblox provides comprehensive documentation for your API's that can be viewed at \"/api/","[your API name]",'/doc". In the case of this example, where our API is called "api_example", the documentation is generated and can be viewed at "/api/api_example/doc".')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Exposing an API 1",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/exposing-an-api1.png")})),Object(o.b)("ol",{start:8},Object(o.b)("li",{parentName:"ol"},"By following this documentation the newly exposed API's operation can be accessed by making a request to the given URL endpoint.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Exposing an API 2",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/exposing-an-api2.png")})),Object(o.b)("ol",{start:9},Object(o.b)("li",{parentName:"ol"},'The documentation will indicate to the reader whether or not the request requires an API key to access the operation, and in our case this API requires no authentication but does require other parameters such as a header, "content-type", and input parameters, "first_name" and "last_name", which are placed in the POST request body.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Exposing an API 3",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/exposing-an-api3.png")})),Object(o.b)("ol",{start:10},Object(o.b)("li",{parentName:"ol"},"After the request has been made the expected output should be inline with the expected output. Using an application, such as ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://www.getpostman.com/"}),"Postman"),' as a test platform to see whether or not the API was successfully created, or alternatively by using the URL "/api/api_example/dummyOperation/first_name=ACoolName/last_name=ACoolSurname" we can compare the collected output to the expected response.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Exposing an API 4",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/exposing-an-api4.png")})),Object(o.b)("ol",{start:11},Object(o.b)("li",{parentName:"ol"},"Lastly , in the documentation, a dropdown menu is provided containing snippets of code that can be copied and placed into your project and language of choice to ease the integration. These snippets come in the most common languages that handle API requests.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Exposing an API 5",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/exposing-an-api5.png")})),Object(o.b)("h2",{id:"securing-api-operations-with-an-api-key"},"Securing API operations with an API key"),Object(o.b)("p",null,'When creating your own API it will be completely exposed and wont require and API key to be accessed. To secure your API operations we can add them to the list of API operations that are under "api_operation_administration" and create a key to control its accessibility.'),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},'Using the "api_example" (see ',Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"#exposing-a-custom-api"}),"Exposing an API"),") to demonstrate this. It is shown in the documentation that the custom API does not require a key which is what we want to change.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 1",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api1.png")})),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},'Add the API operation to the list of controlled operations by opening "api_operation_administration" component in the "Component Builder".')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 2",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api2.png")})),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},'This component allows you to add or remove API operations from the list of access controlled API operations. Add your operation by clicking the "+ Api Operation"')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 3",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api3.png")})),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},'Add the "User Readable Name" (API operation name)to the box and click "Create". This name is from your "addApiOperation()" (in your API\'s .php file) and is case and white space sensitive.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 4",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api4.png")})),Object(o.b)("ol",{start:5},Object(o.b)("li",{parentName:"ol"},"By checking the API documentation we can compare the changes. Note that now the API does require a key to access the operation, and a API key can now be placed in the request body when the request is made to access the operation.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 5",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api5.png")})),Object(o.b)("ol",{start:6},Object(o.b)("li",{parentName:"ol"},'To get a key that will link to your operation and allow you to access it, open the "api_key_administration" component from the "Component Builder" page and add a new API key by clicking the "+ API key".')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 6",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api6.png")})),Object(o.b)("ol",{start:7},Object(o.b)("li",{parentName:"ol"},'The key itself is auto-generated to avoid any internal clashes, as well as providing a strong key string. A start date is required. The end date can be left open which results in the key remaining active indefinitely. Fill in any additional information you may require and click "Create" to finish making the key.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 7",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api7.png")})),Object(o.b)("ol",{start:8},Object(o.b)("li",{parentName:"ol"},'Your newly generated key should be visible in the "api_key_administration" component. Open up the new key to start adding operations to this key.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 8",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api8.png")})),Object(o.b)("ol",{start:9},Object(o.b)("li",{parentName:"ol"},'Start adding operations to this key by clicking "+ API Operation"')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 9",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api9.png")})),Object(o.b)("ol",{start:10},Object(o.b)("li",{parentName:"ol"},"Select the operation you want to link with the API key. Operations that have been newly added are place at the bottom of the list.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 10",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api10.png")})),Object(o.b)("ol",{start:11},Object(o.b)("li",{parentName:"ol"},"To verify that the operation has been added, it should be visible when viewing the API key. It will show the activity status of the operation which can be toggled to manage access.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 11",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api11.png")})),Object(o.b)("ol",{start:12},Object(o.b)("li",{parentName:"ol"},'Testing the API operation with the API key gives back a "Success" status message and completed the API operation.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"Securing an API 12",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/securing-an-api12.png")})),Object(o.b)("h2",{id:"creating-default-crud-apis"},"Creating default CRUD API's"),Object(o.b)("p",null,"Making and exposing access controlled CRUD API operations for new data model entities."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},'Open the "Data Modeler" from the Divblox setup page.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 1",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud1.png")})),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},'This is the Default data model for Divblox. New Entities are added by "Double-clicking" in empty space.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 2",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud2.png")})),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},'Name your new data model entity and click "Create". The name of the data model entity is used as the CRUD API path as well. For this example an entity named "Car" will be created.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 3",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud3.png")})),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},'Start by selecting the module where you want your new entity to be placed. Add new entity attributes by filling in the attribute "name" and "data type" and then add it with the green " + " at the end of the row. Add relationships in the same way, by selecting the entity you need a relationship with and add it using the green " + " at the end of the row. Finish by saving the changes made to the entity')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 4",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud4.png")})),Object(o.b)("ol",{start:5},Object(o.b)("li",{parentName:"ol"},"Sync your data model. Ensure that Divblox's data model is synced so that the CRUD operations can be used.")),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 5",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud5.png")})),Object(o.b)("ol",{start:6},Object(o.b)("li",{parentName:"ol"},'View the auto-generated documentation for the newly created entity using the entity name from before and the path "/api/',"[your API name]",'/doc". These are the default CRUD operations that get created with new data model entities.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 6",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud6.png")})),Object(o.b)("ol",{start:7},Object(o.b)("li",{parentName:"ol"},'Divblox automatically requires an API key for any auto generated operation as they get added and listed in "api_operation_adminstration" (For more see ',Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"#securing-api-operations-with-an-api-key"}),"Securing API operations with an API key"),'). Therefore we must create an API key and link it to the operations we want to expose, thus still keeping them secure with a key. Create the key in the "api_key_administration" component. Select the new key and add the operations using the " + Api Operation" button and select the operations you want from the drop down menu.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 7",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud7.png")})),Object(o.b)("ol",{start:8},Object(o.b)("li",{parentName:"ol"},'The API operations are now exposed and can be accessed using the key that was just created. Testing the "Create Car" operation we will get back a confirmation that the data entry was successful and the "List Car" operation will show the new car that was created.')),Object(o.b)("div",{className:"text--center"},Object(o.b)("img",{alt:"API Default CRUD 8",src:Object(s.a)("_the-basics-media/_5-divblox-apis-media/api-default-crud8.png")})))}d.isMDXComponent=!0},152:function(e,t,a){"use strict";var i=a(0),n=a.n(i),o=a(157),s=a(151),c=a(92),r=a.n(c);const l=37,b=39;t.a=function(e){const{block:t,children:a,defaultValue:c,values:p,groupId:d}=e,{tabGroupChoices:u,setTabGroupChoices:m}=Object(o.a)(),[h,O]=Object(i.useState)(c);if(null!=d){const e=u[d];null!=e&&e!==h&&p.some(t=>t.value===e)&&O(e)}const g=e=>{O(e),null!=d&&m(d,e)},j=[];return n.a.createElement("div",null,n.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(s.a)("tabs",{"tabs--block":t})},p.map(({value:e,label:t})=>n.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":h===e,className:Object(s.a)("tabs__item",r.a.tabItem,{"tabs__item--active":h===e}),key:e,ref:e=>j.push(e),onKeyDown:e=>((e,t,a)=>{switch(a.keyCode){case b:((e,t)=>{const a=e.indexOf(t)+1;e[a]?e[a].focus():e[0].focus()})(e,t);break;case l:((e,t)=>{const a=e.indexOf(t)-1;e[a]?e[a].focus():e[e.length-1].focus()})(e,t)}})(j,e.target,e),onFocus:()=>g(e),onClick:()=>g(e)},t))),n.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},i.Children.toArray(a).filter(e=>e.props.value===h)[0]))}},153:function(e,t,a){"use strict";var i=a(0),n=a.n(i);t.a=function(e){return n.a.createElement("div",null,e.children)}}}]);